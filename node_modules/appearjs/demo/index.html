<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="apple-touch-fullscreen" content="yes"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>无尽列表测试</title>
    <style>
      body{ background: #FC3342; }
      ul,li{padding: 0; margin: 0; list-style: none;}
      @-webkit-keyframes shake{
        0%, 100%{-webkit-transform:translateX(0);}
        10%, 30%, 50%, 70%, 90%{-webkit-transform:translateX(-10px);}
        20%, 40%, 60%, 80%{-webkit-transform:translateX(10px);}
      }
      @keyframes shake{
        0%, 100%{transform:translateX(0);}
        10%, 30%, 50%, 70%, 90%{transform:translateX(-10px);}
        20%, 40%, 60%, 80%{transform:translateX(10px);}
      }
      @-webkit-keyframes loading{
          from{ -webkit-transform: -webkit-rotate(0deg); }
          to{ -webkit-transform: -webkit-rotate(360deg); }
      }
      @keyframes loading{
          from{ transform: rotate(0deg); }
          to{ transform: rotate(360deg); }
      }
      #main .list-wrap{
        overflow: hidden;
      }
      #main .list-item{
        padding: 5px 0;
        background: #fff;
        border: 1px solid #000;
        overflow: hidden;
      }
      #main .pic-wrap{
        float: left;
        height: 100px;
        width: 150px;
      }
      #main .cont-wrap{
        padding: 5px;
        color: #666;
      }
      
      .loading-wrap{
        padding: 5px 0;
        text-align: center;
      }
      .loading-wrap img{
        height: 20px;
        -webkit-animation:loading 0.5s linear infinite;
        animation:loading 0.5s linear infinite;        
      }
      .anim{
        -webkit-animation:shake 0.5s .2s ease both;
        animation:shake 0.5s .2s ease both;
      }
    </style>
  </head>
  <body>
    
    <div id="main">
      <ul class="list-wrap">
      </ul>
      <div class="loading-wrap">
        <img id="loading-icon" class="loading" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAYQAAAGEBVSuQvQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIgSURBVEiJvZZPSBVRFIe/954pRFkKRX9dVEgYBbWIdlYUkdCmVmGLFkHQ3l27JGoRLSJoEUVuwpYtioKChIrQVSUVERIREiVKBGFmX4u54xvH98/n6IHDMPec3/m4d+49d3IqS2n5OjSFpQCuBc4BA8AUMAmMAZ+BYeA2cKimemolP6A+Uv8a2R/1qfpEHVQ/qGMW7a3aWalmuUCDelGdVv+pz9SzamuJ3IJ6Un2dAF+ZDzCn3gnCCXV/lVVI6o6pw0HbWyvwchB8UXfWCEv6GvVdqNFTDdgelvG9uqkOWOwb1ZEA7aoEvBWSjiwAFvsOi9+/JLDNaBcOZQCL/X6YwJ5SwGsheDxD4MFQsy8ey+lMa/sENAJtQJb9bhBYBbQDNCQCzcBIxjCAw0QTIQ1cCfzMGAYwkXyJe18j0LRIwFkWA1eE59QiMDYAu+KX9KZZDazLGPwS2A60wOzr5C7QChzNENYJ7AOG4oE0EOBUhsCe8OyfGUkd1Dfqb3VrBoe+I7S2b2pzuV7aHTrDR6OuXy+sSX0Yap1Jxkolnw+Jr9TldcBa1IFQ44GarwZEvR4Ej9Vt84BttngB96nL0jnlhHn1XhBOq/3q7gqgvepV9XvQXDL6A5iTmzyHacsBJ4ALROcI4AUwCvwKLtAFbAnxr0AvcKPsvq1hmQrqafW5Ou5cG1dvGv3h5avVqzTDcrYe6CBqhz+IDvVkreJ6gAuy/5kfFfSIxzWQAAAAAElFTkSuQmCC" alt="">
      </div>
    </div>

    <script src='../build/appear.debug.js'></script>
    <script>
        (function () {

          var doc = document;
          var str = '<li class="list-item lib-appear">\
                      <img class="pic-wrap" data-src="//gw.alicdn.com/tfscom/tuitui/TB2md1wdVXXXXXXXpXXXXXXXXXX_!!919528325-0-dgshop.jpg" />\
                        <div class="cont-wrap">\
                          这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容，这是条内容。\
                        </div>\
                      </li>';
          var tpl = '';

          for (var i = 0; i < 7; i++) {
            tpl += str
          };

          //宝贝列表实例化
          window.itemAppear = lib.appear.init({
            once: true,
            onAppear: function(){
              console.log(2323);
              //执行懒加载
              var img = this.querySelector('img');
              setTimeout(function(){
                img.src = img.getAttribute('data-src');
              }, 300);
            }
          });

          // 监听loading的appear事件
          doc.querySelector('#loading-icon').addEventListener('appear', function (ev) {
              setTimeout(function () {
                doc.querySelector('#main .list-wrap').innerHTML += tpl;
                //触发判断
                itemAppear.fire();
              }, 500);
          });

          // //loading的实例化
          var loadingAppear = lib.appear.init();
          // //绑定单个元素并且判断是否在可视区域内
          loadingAppear.bind('#loading-icon').fire();

          //触发所有的appear实例
          // lib.appear.fireAll();

        }) () ;
    </script>
  </body>
</html>
